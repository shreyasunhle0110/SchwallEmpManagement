<!DOCTYPE html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
        integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="custom-style.css">
    <title>Timesheet</title>
</head>

<body>
    <div class="container">
        <div class="row header">
            <div class="col-6">
                <h1>Timesheet</h1>
            </div>
            <div class="col-6 text-right">
                <button class="btn btn-primary" id="addTimeSheet">Add Timesheet</button>
            </div>

        </div>
        <div class="row">
            <div class="col-12">
                <div class="table-responsive">
                    <table class="table">
                        <caption>List of Time entries</caption>
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Date</th>
                                <th scope="col">Start</th>
                                <th scope="col">End</th>
                                <th scope="col">Hours</th>
                                <th scope="col">Course</th>
                                <th scope="col">Assignment</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody id="tablebody">

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="timeSheetModal" tabindex="-1" role="dialog" aria-labelledby="timeSheetModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="timeSheetModalLabel">Add Time</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="action" />
                    <div class="form-group">
                        <label for="datepicker">Date</label>
                        <input id="datepicker" class="form-control" placeholder="Date" />
                        <!-- <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                            else.</small> -->
                    </div>
                    <div class="form-group">
                        <label for="start">Start Time</label>
                        <input class="form-control" id="start" type="text" placeholder="Start time" />
                        <!-- <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                            else.</small> -->
                    </div>
                    <div class="form-group">
                        <label for="end">End Time</label>
                        <input type="text" id="end" class="form-control" placeholder="End Time" />
                        <!-- <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                            else.</small> -->
                    </div>
                    <div class="form-group">
                        <label for="hours">Hours</label>
                        <input id="hours" class="form-control" placeholder="Hours" />
                        <!-- <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                            else.</small> -->
                    </div>
                    <div class="form-group">
                        <label for="course">Course</label>
                        <input type="text" id="course" class="form-control" placeholder="Course" />
                        <!-- <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                            else.</small> -->
                    </div>
                    <div class="form-group">
                        <label for="assignment">Assignment</label>
                        <input type="file" id="assignment" class="form-control-file" placeholder="Assignment" />
                        <!-- <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                            else.</small> -->
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" id="save" class="btn btn-primary" data-dismiss="modal">Save changes</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
    <script>
        const data = [];
        startHour = null;
        endHour = null;
        editIndex = null;
        $('#datepicker').datepicker({
            uiLibrary: 'bootstrap'
        });

        $('#start').timepicker({
            uiLibrary: 'bootstrap'
        }).change(startChange)
            .on('start', startChange);

        $('#end').timepicker({
            uiLibrary: 'bootstrap'
        }).change(endChange)
            .on('end', endChange);

        $('#save').click(function () {
            const date = $('#datepicker').val();
            const start = $('#start').val();
            const end = $('#end').val();
            const hours = $('#hours').val();
            const course = $('#course').val();
            const assignment = $('#assignment').val();
            if (date != '' && start != '' && end != '' && hours != '' && course != '' && assignment != '') {
                startHour = null;
                endHour = null;
                if ($('#action').val() === 'add') {
                    data.push({ date: date, start: start, end: end, hours: hours, course: course, assignment: assignment });
                } else {
                    data[editIndex].date = date;
                    data[editIndex].start = start;
                    data[editIndex].end = end;
                    data[editIndex].hours = hours;
                    data[editIndex].course = course;
                    data[editIndex].assignment = assignment;
                }
                bindTable();
            } else {
                alert('Please fill all Required fields')
                return false;
            }
        });

        $('#addTimeSheet').click(function () {
            $('#action').val('add');
            formRest();
            $('#timeSheetModal').modal('show');
        });

        $(document).delegate('button[id^="edit_"]', 'click', function () {
            $('#action').val('edit');
            $('#timeSheetModal').modal('show');
            editIndex = $(this).attr('id').split('_')[1];
            $('#datepicker').val(data[editIndex].date);
            $('#start').val(data[editIndex].start);
            $('#end').val(data[editIndex].end);
            $('#hours').val(data[editIndex].hours);
            $('#course').val(data[editIndex].course);
            $('#assignment').val(data[editIndex].assignment);
        });

        $(document).delegate('button[id^="delete_"]', 'click', function () {
            const index = $(this).attr('id').split('_')[1];
            delete data[index];
            bindTable();
        });


        function startChange(ev) {
            startHour = Number($('#start').val().split(':')[0]) * 60 + Number($('#start').val().split(':')[1])
            if (endHour) {
                const hours = endHour - startHour;
                $('#hours').val(Math.round(hours / 60))
            }

        }

        function endChange(ev) {
            endHour = Number($('#end').val().split(':')[0]) * 60 + Number($('#end').val().split(':')[1])
            if (startHour) {
                const hours = endHour - startHour;
                $('#hours').val(Math.round(hours / 60))
            }
        }

        function bindTable() {
            const table = [];
            data.map((x, i) => {
                table.push(`
                    <tr>
                        <td>${i + 1}</td>
                        <td>${x.date}</td>
                        <td>${x.start}</td>
                        <td>${x.end}</td>
                        <td>${x.hours}</td>
                        <td>${x.course}</td>
                        <td>${x.assignment}</td>
                        <td>
                            <button class="btn btn-primary mr-2" id="edit_${i}">Edit</button>
                            <button class="btn btn-secondary" id="delete_${i}">Delete</button>
                        </td>
                    </tr>`);
            });
            $('#tablebody').html(table);
        }

        function formRest() {
            $('#datepicker').val('');
            $('#start').val('');
            $('#end').val('');
            $('#hours').val('');
            $('#course').val('');
            $('#assignment').val('');
        }
    </script>
</body>

</html>